dist: bionic
os: linux
arch:
  - amd64
  - arm64
language: node_js
node_js:
  - 14

cache:
  yarn: true
  directories:
    - $HOME/.cache/electron
    - $HOME/.cache/electron-builder
    - $HOME/.npm/_prebuilds

before_install:
  - git clone --depth=1 https://github.com/raspberrypi/tools.git /tmp/tools
  - export PATH=/tmp/tools/arm-bcm2708/arm-linux-gnueabihf/bin:$PATH

addons:
  snaps:
    - name: snapcraft
      channel: stable
      classic: true
    - name: transfer
    - name: http
    - name: lxd
      channel: stable
  apt:
    update: true

script:
  - sudo /snap/bin/lxd.migrate -yes
  - sudo /snap/bin/lxd waitready
  - sudo /snap/bin/lxd init --auto
  - yarn make
  # - sudo snapcraft --use-lxd

after_success:
  - echo *.snap "$(echo "$TRAVIS_REPO_SLUG" | sed -e 's|.*/\(.*\)|\1|')-pr$TRAVIS_PULL_REQUEST.snap"

after_failure:
  - sudo journalctl -u snapd

deploy:
  provider: snap
  snap: dist/ozone-display*.snap
  channel: edge
  skip_cleanup: true
